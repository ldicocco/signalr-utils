(function(){var t,u,r,n,i;n=null,i=null,t=$.connection.webRTCHub,$.connection.hub.url="/signalr/hubs",$.connection.hub.start(function(){return console.log("connected to signal server."),u()}),r=function(){var n;return console.log("creating RTCPeerConnection..."),n=new RTCPeerConnection(null),n.onicecandidate=function(n){n.candidate!=null&&t.server.send(JSON.stringify({candidate:n.candidate}))},n.onaddstream=function(n){var t;t=document.createElement("video"),t.className="video",t.autoplay="autoplay",attachMediaStream(t,n.stream),document.querySelector("body").appendChild(t),document.querySelector("#startBtn").setAttribute("disabled","disabled")},n},t.client.newMessage=function(u){var f,e;e=JSON.parse(u),f=n!=null?n:r(null),e.sdp!=null?f.setRemoteDescription(new RTCSessionDescription(e.sdp),function(){f.remoteDescription.type==="offer"?(console.log("received offer, sending answer..."),f.addStream(i),f.createAnswer(function(n){return f.setLocalDescription(n,function(){return t.server.send(JSON.stringify({sdp:f.localDescription}))})})):f.remoteDescription.type==="answer"&&console.log("got an answer")}):e.candidate!=null&&(console.log("adding ice candidate..."),f.addIceCandidate(new RTCIceCandidate(e.candidate))),n=f},u=function(){return getUserMedia({video:!0,audio:!0},function(n){var t;t=document.getElementById("rtcVideo"),i=n,attachMediaStream(t,i),document.querySelector("#startBtn").removeAttribute("disabled")},function(n){return alert(JSON.stringify(n))}),document.querySelector("#startBtn").addEventListener("click",function(){n==null&&(n=r(null)),n.addStream(i),n.createOffer(function(i){n.setLocalDescription(i,function(){t.server.send(JSON.stringify({sdp:i}))})})})}}).call(this)